---
title: "2.14 - Header Parameters en FastAPI"
description: "Gu칤a para manejar encabezados HTTP, conversiones autom치ticas y listas de valores."
tags: ["fastapi", "headers", "python", "http"]
prompt-version: cheat-sheet-generator-1.1
---

## A - Importaci칩n y Declaraci칩n de Headers [游댮 Fundamental]

#### 1. **Introducci칩n:**

Para leer informaci칩n de los encabezados HTTP (Headers), necesitas importar expl칤citamente `Header` de FastAPI y declararlo en tu funci칩n, similar a como har칤as con `Path` o `Query`.

#### 2. **Ejemplo:**

```python
from typing import Annotated
from fastapi import FastAPI, Header # <--- 1. Importamos Header

app = FastAPI()

@app.get("/items/")
# 2. Declaramos que user_agent viene del Header, no de la URL
async def read_items(user_agent: Annotated[str | None, Header()] = None):
    return {"User-Agent": user_agent}
```

**Explicaci칩n del ejemplo:**
Aqu칤 le estamos diciendo a FastAPI: "Busca un valor llamado `user-agent` en los encabezados de la petici칩n". Si no us치ramos `Header()`, FastAPI creer칤a err칩neamente que `user_agent` es un par치metro de consulta (query param) que viene en la URL (ej: `?user_agent=algo`).

#### 3. **Desarrollo:**

Es vital entender que `Header` es una clase "hermana" de `Path` y `Query`. Todas heredan de una clase com칰n (`Param`). Sin embargo, **tienes** que usar `Header()` expl칤citamente. Si solo pones `user_agent: str`, FastAPI buscar치 en la query string, no en los headers.

---

## B - Comparativa: Annotated vs. Estilo Antiguo [游리 Importante]

#### 1. **Introducci칩n:**

Ver치s dos formas de escribir esto en la documentaci칩n o tutoriales viejos; aunque ambas funcionan, hay una clara ganadora moderna.

#### 2. **Ejemplo:**

```python
# OPCI칍N A: La forma moderna y recomendada (Usando Annotated)
user_agent: Annotated[str | None, Header()] = None

# OPCI칍N B: La forma antigua (Usando valor por defecto)
user_agent: str | None = Header(default=None)
```

**Explicaci칩n del ejemplo:**
Ambas l칤neas hacen exactamente lo mismo: definen un header opcional.

#### 3. **Desarrollo:**

쯇or qu칠 elegir una sobre la otra?

- **Annotated (Opci칩n A):** Es el est치ndar actual de Python. Permite separar el **tipo** de dato (`str | None`) de los **metadatos** de FastAPI (`Header()`). Esto hace que tu c칩digo sea m치s compatible con otras herramientas y linters.
- **Estilo Antiguo (Opci칩n B):** Pone `Header()` como valor por defecto (`= Header(...)`). Esto puede confundir a herramientas externas o tests que esperan un valor literal por defecto (como `None` o `"string"`).

**Veredicto del Pedagogo:** Usa siempre **Annotated** si es posible. Es m치s limpio y "a prueba de futuro". Solo usa la opci칩n B si est치s obligado a usar versiones muy viejas de Python.

---

## C - Conversi칩n Autom치tica: De Python a HTTP [游댮 Fundamental]

#### 1. **Introducci칩n:**

FastAPI convierte autom치ticamente los guiones bajos (`_`) de tus variables de Python a guiones medios (`-`) de los headers HTTP.

#### 2. **Ejemplo:**

```python
# En tu c칩digo Python escribes:
async def read_items(user_agent: Annotated[str | None, Header()] = None): ...

# FastAPI buscar치 en la petici칩n HTTP:
# User-Agent: Mozilla/5.0...
```

**Explicaci칩n del ejemplo:**
En Python, las variables como `user-agent` (con guion medio) son **ilegales** (dar칤a error de sintaxis). Por eso usas `user_agent` (snake_case). FastAPI sabe esto y hace la traducci칩n por ti: `user_agent` en c칩digo se convierte en `user-agent` en el header.

#### 3. **Desarrollo:**

Esta funcionalidad existe para facilitarte la vida. La mayor칤a de los headers est치ndar usan guiones (ej: `Content-Type`, `X-Token`, `Accept-Language`). Gracias a esta conversi칩n, no tienes que hacer malabares extra침os para capturarlos.

---

## D - Insensibilidad a May칰sculas (Case Insensitive) [游댯 Espec칤fico]

#### 1. **Introducci칩n:**

No importa si el cliente env칤a el header en may칰sculas, min칰sculas o mezclado; FastAPI lo entender치 igual.

#### 2. **Ejemplo:**

```python
# Tu c칩digo espera: user_agent

# Petici칩n del cliente A:
# User-Agent: chrome

# Petici칩n del cliente B:
# user-agent: chrome

# Petici칩n del cliente C:
# USER-AGENT: chrome
```

**Explicaci칩n del ejemplo:**
En los tres casos del ejemplo, tu variable `user_agent` recibir치 el valor `"chrome"`.

#### 3. **Desarrollo:**

Los headers HTTP son, por definici칩n del protocolo, "case-insensitive". FastAPI respeta esto. Puedes declarar tu variable como `user_agent` (est치ndar de Python) y no necesitas preocuparte si el cliente envi칩 `User_Agent`, `User-Agent` o `USER_AGENT`.

---

## E - Desactivar la Conversi칩n Autom치tica [游댯 Espec칤fico]

#### 1. **Introducci칩n:**

Si por alguna extra침a raz칩n necesitas que el header tenga literalmente un guion bajo (`_`) y no un guion medio (`-`), puedes apagar la conversi칩n autom치tica.

#### 2. **Ejemplo:**

```python
@app.get("/items/")
async def read_items(
    # convert_underscores=False obliga a buscar "strange_header" tal cual
    strange_header: Annotated[str | None, Header(convert_underscores=False)] = None
):
    return {"strange_header": strange_header}
```

**Explicaci칩n del ejemplo:**
Al poner `convert_underscores=False`, FastAPI buscar치 un header que sea literalmente `strange_header`. Si el cliente env칤a `strange-header`, FastAPI lo ignorar치 (o devolver치 null).

#### 3. **Desarrollo:**

**춰Cuidado!** Antes de usar esto, ten en cuenta que algunos servidores proxy y servidores HTTP **proh칤ben** el uso de guiones bajos en los headers. Podr칤as encontrarte con que tu aplicaci칩n funciona en local pero falla al subirla a producci칩n porque un intermediario bloquea esos headers. 칔salo solo si es estrictamente necesario.

---

## F - Headers Duplicados (Listas) [游댯 Espec칤fico]

#### 1. **Introducci칩n:**

Es posible recibir el mismo header varias veces en una sola petici칩n; para capturarlos todos, declaras el tipo como una lista (`list`).

#### 2. **Ejemplo:**

```python
from typing import Annotated
from fastapi import FastAPI, Header

app = FastAPI()

@app.get("/items/")
# Notar el tipo: list[str]
async def read_items(x_token: Annotated[list[str] | None, Header()] = None):
    return {"X-Token values": x_token}
```

**Explicaci칩n del ejemplo:**
Si un cliente env칤a una petici칩n con estos headers:
`X-Token: foo`
`X-Token: bar`

Tu variable `x_token` ser치 una lista de Python: `["foo", "bar"]` (o `["bar", "foo"]`, el orden depende de la recepci칩n).

#### 3. **Desarrollo:**

Esto es muy com칰n en ciertos sistemas de autenticaci칩n o rastreo donde se acumulan valores. Si declararas esto solo como `str` en lugar de `list[str]`, FastAPI probablemente solo te dar칤a el 칰ltimo valor recibido, perdiendo informaci칩n. Al usar `list`, le dices expl칤citamente: "Espero que esto pueda venir repetido, gu치rdalo todo".
