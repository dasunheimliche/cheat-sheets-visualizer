---
title: "2.21 - Modelos de Formulario en FastAPI"
description: "C칩mo usar clases Pydantic para recibir y validar datos de formularios cl치sicos."
tags: ["fastapi", "forms", "pydantic", "validation"]
---

## A - Dependencia `python-multipart`: El Motor Oculto [游댮]

#### 1. **Introducci칩n:**

Antes de escribir una sola l칤nea de c칩digo para formularios, necesitas instalar una herramienta espec칤fica, ya que FastAPI no procesa formularios por s칤 solo "de f치brica".

#### 2. **Ejemplo:**

```bash
# En tu terminal, con tu entorno virtual activado:
pip install python-multipart
```

#### 3. **Desarrollo:**

Imagina que FastAPI es un chef experto, pero para cocinar "Formularios", necesita un utensilio especial que no viene en la caja b치sica. Ese utensilio es `python-multipart`. Si intentas usar `Form` sin instalar esto, tu aplicaci칩n te gritar치 un error.

游댮 **Fundamental**: Sin esta librer칤a instalada, nada de lo que explicaremos a continuaci칩n funcionar치. Es el paso 0 real.

---

## B - Modelos Pydantic para Formularios: Agrupando tus Datos [游댮]

#### 1. **Introducci칩n:**

En lugar de definir cada campo del formulario suelto en la funci칩n (ej: `user`, `password`), creamos una "plantilla" (Clase) que los contiene todos juntos.

#### 2. **Ejemplo:**

```python
from typing import Annotated
from fastapi import FastAPI, Form
from pydantic import BaseModel

app = FastAPI()

# 1. Definimos la plantilla (El Modelo)
class FormData(BaseModel):
    username: str
    password: str

# 2. Usamos la plantilla en la ruta
@app.post("/login/")
async def login(data: Annotated[FormData, Form()]):
    return data
```

**Explicaci칩n del ejemplo:**
Creamos una clase `FormData` que hereda de `BaseModel`. Luego, en la funci칩n `login`, le decimos a FastAPI: "Espera recibir algo que encaje con `FormData`, y b칰scalo dentro de los datos del **Formulario** (`Form()`)".

#### 3. **Desarrollo:**

Esto es genial porque mantiene tu c칩digo limpio. Si tu formulario tiene 20 campos, no querr치s tener 20 argumentos en tu funci칩n `login(...)`. Con esto, recibes un solo objeto `data` que ya tiene todo ordenado dentro.
_Nota: Esto est치 soportado desde la versi칩n 0.113.0 de FastAPI._

游댮 **Fundamental**: Es la forma moderna y organizada de manejar datos de formularios complejos en FastAPI.

---

## C - Comparativa: `Annotated` vs Sintaxis Antigua [游리]

#### 1. **Introducci칩n:**

Ver치s dos formas de escribir esto. Una moderna (recomendada) y una antigua. Ambas funcionan, pero debes saber cu치l elegir.

#### 2. **Ejemplo:**

**Opci칩n A: La Recomendada (Annotated)**

```python
# Claridad total: "Es de tipo FormData y viene de Form()"
async def login(data: Annotated[FormData, Form()]):
```

**Opci칩n B: La Antigua / Alternativa**

```python
# Funciona, pero mezcla el valor por defecto con la definici칩n
async def login(data: FormData = Form()):
```

#### 3. **Desarrollo:**

Aqu칤 quiero detenerme porque esto confunde a muchos.

- **La Opci칩n A (`Annotated`)** es la forma "Pythonica" moderna. Separa claramente _qu칠 es_ el dato (FormData) de _c칩mo obtenerlo_ (Form). Es lo que ver치s en la documentaci칩n m치s nueva.
- **La Opci칩n B (`= Form()`)** usa el valor por defecto para decirle a FastAPI qu칠 hacer. Es v치lida, pero `Annotated` tiene mejor soporte para herramientas externas y editores de c칩digo.

**쮺u치l elijo?**
춰Usa siempre `Annotated` si puedes! (Python 3.9+). Solo usa la opci칩n B si est치s atado a versiones muy viejas de Python o mantienes c칩digo antiguo.

游리 **Importante**: Aunque ambas funcionan, acostumbrarse a `Annotated` es invertir en el futuro y en mejores pr치cticas.

---

## D - Extracci칩n de Datos: La Magia Autom치tica [游댯]

#### 1. **Introducci칩n:**

FastAPI hace el trabajo sucio: lee el formulario campo por campo y lo "inyecta" en tu modelo.

#### 2. **Ejemplo:**

Si el cliente env칤a un formulario HTML con:

- input name="username" value="Pepe"
- input name="password" value="1234"

FastAPI autom치ticamente crea una instancia de `FormData` donde `data.username` es "Pepe".

#### 3. **Desarrollo:**

No tienes que parsear nada manualmente. FastAPI busca en la petici칩n (request) los campos que coincidan exactamente con los nombres de las variables en tu clase `FormData`.

游댯 **Espec칤fico**: Es bueno saber que esto ocurre "campo por campo" para entender c칩mo depurar si algo no llega bien.

---

## E - Verificaci칩n en Docs: Ver para Creer [游리]

#### 1. **Introducci칩n:**

Puedes comprobar que todo funciona sin escribir un frontend, usando la interfaz autom치tica de FastAPI.

#### 2. **Ejemplo:**

Ve a `http://localhost:8000/docs` en tu navegador. Ver치s esto:

![Docs UI](https://fastapi.tiangolo.com/img/tutorial/request-form-models/image01.png)

#### 3. **Desarrollo:**

La interfaz Swagger UI detecta que usaste `Form()` y te mostrar치 los campos como un formulario web, no como un JSON crudo. Es vital para probar tu API r치pidamente.

游리 **Importante**: Es tu herramienta principal de prueba y depuraci칩n.

---

## F - Prohibir Campos Extra: El Portero Estricto [游댯]

#### 1. **Introducci칩n:**

A veces quieres ser muy estricto y rechazar la petici칩n si el cliente env칤a datos que no pediste (datos "basura" o extra).

#### 2. **Ejemplo:**

```python
class FormData(BaseModel):
    username: str
    password: str

    # Configuraci칩n para prohibir extras:
    model_config = {"extra": "forbid"}

@app.post("/login/")
async def login(data: Annotated[FormData, Form()]):
    return data
```

#### 3. **Desarrollo:**

Por defecto, Pydantic suele ignorar los campos extra. Pero si a침ades `model_config = {"extra": "forbid"}`, activas un modo de seguridad estricta.
_Nota: Soportado desde FastAPI 0.114.0._

游댯 **Espec칤fico**: 칔til para APIs p칰blicas o de alta seguridad donde quieres asegurarte de que el cliente sigue el contrato al pie de la letra.

---

## G - Error por Campos Extra: La Tarjeta Roja [游댯]

#### 1. **Introducci칩n:**

Si activaste la prohibici칩n de campos extra (Concepto F) y alguien env칤a algo de m치s, FastAPI devolver치 un error autom치tico.

#### 2. **Ejemplo:**

**El cliente env칤a:**

- `username`: "Rick"
- `password`: "Portal Gun"
- `extra`: "Mr. Poopybutthole" <--- 춰CAMPO NO PERMITIDO!

**FastAPI responde (Error 422):**

```json
{
  "detail": [
    {
      "type": "extra_forbidden",
      "loc": ["body", "extra"],
      "msg": "Extra inputs are not permitted",
      "input": "Mr. Poopybutthole"
    }
  ]
}
```

#### 3. **Desarrollo:**

El mensaje es claro: "Extra inputs are not permitted" (Entradas extra no permitidas). Esto ayuda al desarrollador del frontend a saber que est치 enviando basura que debe limpiar.

游댯 **Espec칤fico**: Es la consecuencia directa de usar la configuraci칩n `forbid`.
