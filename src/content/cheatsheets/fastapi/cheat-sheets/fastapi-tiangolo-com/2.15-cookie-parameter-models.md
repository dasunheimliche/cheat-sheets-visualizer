---
title: "2.15 - Cookie Parameter Models en FastAPI"
description: "Gu√≠a completa para agrupar, validar y gestionar cookies usando modelos Pydantic"
tags: ["fastapi", "cookies", "pydantic", "validation", "models"]
---

## A - Modelos de Par√°metros de Cookie [üü° Importante]

#### 1. **Introducci√≥n:**

En lugar de declarar tus cookies una por una (como variables sueltas), puedes agruparlas todas dentro de una **clase de Pydantic** (un modelo) para mantener tu c√≥digo ordenado y reutilizable.

#### 2. **Ejemplo:**

```python
# Definimos el "molde" de nuestras cookies
class MisCookies(BaseModel):
    session_id: str
    tracker_id: str | None = None

# Ahora 'MisCookies' es un paquete que contiene ambas.
```

#### 3. **Desarrollo:**

Esta funcionalidad te permite declarar validaciones y metadatos para un grupo entero de par√°metros a la vez.
**Nota Importante:** Esto est√° soportado desde **FastAPI versi√≥n 0.115.0**. Si tu c√≥digo falla, ¬°revisa tu versi√≥n!

---

## B - Implementaci√≥n con Pydantic & Annotated [üî¥ Fundamental]

#### 1. **Introducci√≥n:**

Para usar el modelo, lo declaras en tu funci√≥n usando `Annotated` y `Cookie()`. Esto le dice a FastAPI: "Usa este modelo, pero llena sus datos leyendo las Cookies".

#### 2. **Ejemplo:**

```python
from typing import Annotated
from fastapi import Cookie, FastAPI
from pydantic import BaseModel

app = FastAPI()

# 1. Creas el modelo
class Cookies(BaseModel):
    session_id: str
    fatebook_tracker: str | None = None
    googall_tracker: str | None = None

# 2. Lo inyectas en la ruta
@app.get("/items/")
async def read_items(cookies: Annotated[Cookies, Cookie()]):
    return cookies
```

**Explicaci√≥n del ejemplo:**
FastAPI leer√° las cookies de la petici√≥n. Si encuentra `session_id`, lo pondr√° en el campo `session_id` de tu objeto `cookies`. Si no encuentra las opcionales, las dejar√° como `None`.

#### 3. **Desarrollo:**

El texto recomienda encarecidamente usar la sintaxis `Annotated[...]` (disponible en Python moderno) sobre la sintaxis antigua (`cookies: Cookies = Cookie()`). Aunque ambas funcionan, `Annotated` es el est√°ndar actual para mejor soporte de editores y herramientas.

---

## C - Universalidad (Query & Header) [üü° Importante]

#### 1. **Introducci√≥n:**

Este truco de "empaquetar" par√°metros en un modelo Pydantic no es exclusivo de las cookies; funciona id√©ntico para `Query` y `Header`.

#### 2. **Ejemplo:**

- Para Cookies: `Annotated[TuModelo, Cookie()]` üç™
- Para Querys: `Annotated[TuModelo, Query()]` ‚ùì
- Para Headers: `Annotated[TuModelo, Header()]` üß¢

#### 3. **Desarrollo:**

Es vital que entiendas esto para no aprender tres formas distintas de hacer lo mismo. Si tienes una ruta con 10 par√°metros de b√∫squeda (Query params), ¬°haz un modelo Pydantic y √∫salo igual que hicimos aqu√≠ con las cookies!

---

## D - Visualizaci√≥n en Docs UI [üîµ Espec√≠fico]

#### 1. **Introducci√≥n:**

Al usar un modelo, la documentaci√≥n autom√°tica (`/docs`) generar√° una interfaz limpia mostrando todos los campos esperados dentro de ese modelo.

#### 2. **Ejemplo:**

![image](https://fastapi.tiangolo.com/img/tutorial/cookie-param-models/image01.png)

#### 3. **Desarrollo:**

FastAPI desglosa el modelo Pydantic y muestra cada campo (`session_id`, `fatebook_tracker`, etc.) individualmente en la UI para que sepas qu√© enviar.

---

## E - La "Trampa" del Navegador en Docs [üü° Importante]

#### 1. **Introducci√≥n:**

Aunque la UI te permite escribir valores para las cookies y darle a "Execute", es muy probable que **falle** y no env√≠e nada.

#### 2. **Ejemplo:**

- Escribes `123` en `session_id` en la web `/docs`.
- Pulsas "Execute".
- **Resultado:** Error de "campo requerido faltante" (como si no hubieras escrito nada).

#### 3. **Desarrollo:**

**¬°No te asustes, tu c√≥digo est√° bien!** Esto sucede porque los navegadores tienen medidas de seguridad muy estrictas y a menudo impiden que JavaScript (que controla la UI de la documentaci√≥n) manipule o env√≠e cookies arbitrarias. Para probar cookies de verdad, usa herramientas como `curl` o Postman, no conf√≠es ciegamente en el bot√≥n "Execute" del navegador para este caso espec√≠fico.

---

## F - Prohibir Cookies Extra (Forbid Extra) [üîµ Espec√≠fico]

#### 1. **Introducci√≥n:**

Puedes configurar tu API para que sea "celosa" y rechace la petici√≥n si el cliente env√≠a cookies que no est√°n expl√≠citamente definidas en tu modelo.

#### 2. **Ejemplo:**

```python
class Cookies(BaseModel):
    # Configuraci√≥n para rechazar extras
    model_config = {"extra": "forbid"}

    session_id: str
    fatebook_tracker: str | None = None

# Si env√≠an una cookie "santa_tracker", la API dar√° error.
```

#### 3. **Desarrollo:**

Esto se hace a√±adiendo `model_config = {"extra": "forbid"}` dentro de tu clase Pydantic. Es √∫til para casos de seguridad estricta o cumplimiento legal (como el consentimiento de cookies), asegurando que tu API no procese nada que no haya "firmado un contrato" previo en tu modelo.
