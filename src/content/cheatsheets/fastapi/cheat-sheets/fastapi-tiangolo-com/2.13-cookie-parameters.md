---
title: "2.13 - Par치metros de Cookie en FastAPI"
description: "C칩mo leer cookies del navegador de forma segura y correcta"
tags: ["fastapi", "cookies", "python", "annotated"]
---

## A - Importaci칩n de `Cookie`: Trayendo la herramienta [游댮]

#### 1. **Introducci칩n:**

Para leer cookies, no podemos usar tipos de datos simples (como `str` o `int`) directamente; necesitamos importar expl칤citamente `Cookie` desde `fastapi`.

#### 2. **Ejemplo:**

```python
from typing import Annotated
from fastapi import Cookie, FastAPI # <--- 춰Aqu칤 est치 la clave!

app = FastAPI()
```

**Explicaci칩n del ejemplo:**
Simplemente estamos sacando la herramienta `Cookie` de la caja de herramientas de `fastapi` para poder usarla m치s adelante en nuestras funciones.

#### 3. **Desarrollo:**

Si intentas definir una cookie sin importar esto, Python no sabr치 de qu칠 est치s hablando. Es el primer paso obligatorio.

游댮 **Fundamental**: Sin esta importaci칩n, no puedes definir par치metros de tipo Cookie. Es la base de todo este cap칤tulo.

---

## B - Declaraci칩n de Par치metros de Cookie: Buscando en el lugar correcto [游댮]

#### 1. **Introducci칩n:**

Definimos un par치metro de cookie igual que lo har칤amos con `Query` o `Path`, indicando que el valor de esa variable debe extraerse de las cookies del navegador.

#### 2. **Ejemplo:**

```python
@app.get("/items/")
# Buscamos una cookie llamada "ads_id".
# Si no existe, valdr치 None.
async def read_items(ads_id: Annotated[str | None, Cookie()] = None):
    return {"ads_id": ads_id}
```

**Explicaci칩n del ejemplo:**
Aqu칤 le decimos a FastAPI: "Oye, busca una variable llamada `ads_id`. Pero **no** la busques en la URL (query), b칰scala dentro de las **Cookies** de la petici칩n". El `= None` al final significa que si la cookie no viene, no pasa nada, la variable ser치 `None`.

#### 3. **Desarrollo:**

La estructura es id칠ntica a cuando usas `Query` o `Path`. Puedes definir validaciones extra, valores por defecto, etc. Lo importante es que al usar `Cookie()`, FastAPI sabe autom치ticamente que debe leer las cabeceras HTTP buscando esa cookie espec칤fica.

游댮 **Fundamental**: Es la mec치nica principal para leer informaci칩n persistente del usuario (como IDs de sesi칩n o rastreo de anuncios).

---

## C - Sintaxis: `Annotated` vs. `default` (Comparaci칩n) [游리]

#### 1. **Introducci칩n:**

Existen dos formas de escribir esto: la moderna (usando `Annotated`, recomendada) y la cl치sica (asignando el valor por defecto). Ambas funcionan, pero una es preferible.

#### 2. **Ejemplo:**

```python
# OPCI칍N A: RECOMENDADA (Python 3.9+)
# Usamos Annotated para meter la metadata de Cookie() junto al tipo.
async def read_items_modern(ads_id: Annotated[str | None, Cookie()] = None):
    ...

# OPCI칍N B: CL츼SICA (Funciona, pero es menos expl칤cita para herramientas externas)
# Asignamos Cookie() como valor por defecto.
async def read_items_classic(ads_id: str | None = Cookie(default=None)):
    ...
```

#### 3. **Desarrollo:**

Aqu칤 quiero que prestes mucha atenci칩n porque ver치s ambos estilos en internet:

- **Opci칩n A (`Annotated`)**: Es la **recomendada** por FastAPI hoy en d칤a. Separa claramente el "qu칠 es" (un `str` o `None`) del "de d칩nde viene" (`Cookie()`). Esto ayuda a que otros programas (IDEs, linters) entiendan mejor tu c칩digo.
- **Opci칩n B (Cl치sica)**: Es la forma antigua. Funciona perfectamente, pero mezcla un poco la definici칩n del tipo con la funci칩n de FastAPI.

**쮺u치l elegir?**
Siempre que puedas, usa **`Annotated`**. Es el futuro del framework y te evitar치 dolores de cabeza con herramientas de tipado est치tico. Solo usa la cl치sica si est치s obligado a usar versiones muy viejas de Python o FastAPI.

游리 **Importante**: Aunque ambas funcionan, acostumbrarse a `Annotated` es una mejor pr치ctica profesional actual.

---

## D - La Necesidad de `Cookie`: 쯇or qu칠 no solo `str`? [游댮]

#### 1. **Introducci칩n:**

Si declaras un par치metro sin usar `Cookie()`, FastAPI asumir치 por defecto que es un **Query Parameter** (parte de la URL), no una cookie.

#### 2. **Ejemplo:**

```python
# MAL: FastAPI buscar치 ?ads_id=123 en la URL
async def read_items_bad(ads_id: str | None = None):
    ...

# BIEN: FastAPI buscar치 la cookie "ads_id" en las cabeceras
async def read_items_good(ads_id: Annotated[str | None, Cookie()] = None):
    ...
```

#### 3. **Desarrollo:**

FastAPI es inteligente, pero no lee mentes. Por defecto, cualquier variable simple en la funci칩n se interpreta como un par치metro de consulta (`?variable=valor`). Para cambiar ese comportamiento y forzarlo a mirar en las cookies, **tienes** que usar `Cookie()`. Es la 칰nica forma de "desviar" la atenci칩n de FastAPI hacia las cookies.

游댮 **Fundamental**: Si olvidas poner `Cookie()`, tu c칩digo funcionar치, pero leer치 los datos del lugar equivocado (la URL en vez de la cookie), creando un bug silencioso.

---

## E - Relaci칩n T칠cnica: La familia `Param` [游댯]

#### 1. **Introducci칩n:**

T칠cnicamente, `Cookie` es una clase "hermana" de `Path` y `Query`. Todas heredan de una clase padre com칰n llamada `Param`.

#### 2. **Ejemplo:**

_(No requiere c칩digo, es un concepto estructural)_.
Imagina un 치rbol geneal칩gico:

- Padre: `Param`
- Hijos: `Cookie`, `Query`, `Path`

#### 3. **Desarrollo:**

Esto significa que casi todo lo que aprendiste para `Query` (validaciones de longitud, t칤tulos, descripciones para la documentaci칩n) funciona exactamente igual para `Cookie`. No tienes que aprender reglas nuevas, solo cambiar la palabra clave.

**Nota paranoica:** Recuerda que cuando importas `Cookie`, `Path` o `Query`, en realidad son funciones que devuelven instancias de clases especiales. No necesitas instanciarlas t칰 manualmente con `new` o algo as칤, FastAPI lo hace por ti.

游댯 **Espec칤fico**: Es bueno saberlo para entender la consistencia del framework, pero no necesitas memorizar la jerarqu칤a de clases para programar.

---

## F - Limitaciones del Navegador y Docs UI: La trampa de JavaScript [游리]

#### 1. **Introducci칩n:**

Los navegadores protegen mucho las cookies. Por seguridad, a menudo impiden que JavaScript acceda a ellas. Esto afecta c칩mo pruebas tu API en la documentaci칩n autom치tica (`/docs`).

#### 2. **Ejemplo:**

_Situaci칩n:_

1. Vas a `http://127.0.0.1:8000/docs`.
2. Ves el candadito para la cookie `ads_id`.
3. Escribes un valor y le das a "Execute".
4. **Resultado:** Error o valor vac칤o.

#### 3. **Desarrollo:**

춰No entres en p치nico! Tu c칩digo probablemente est치 bien.
La interfaz de documentaci칩n (`/docs`) usa JavaScript para ejecutarse. Debido a protocolos de seguridad web, los navegadores a veces bloquean que el JavaScript de la UI env칤e cookies arbitrarias.

**쯈u칠 significa esto?**
Que aunque la documentaci칩n te permita escribir el valor de la cookie, es posible que **no se env칤e** realmente al servidor cuando hagas clic. Si ves un error diciendo que falta la cookie, no asumas inmediatamente que tu c칩digo Python est치 mal; es muy probable que sea una limitaci칩n de la interfaz de prueba del navegador.

游리 **Importante**: Te ahorrar치 horas de depuraci칩n pensando que tu c칩digo est치 roto cuando en realidad es una restricci칩n de seguridad del navegador en la interfaz de Swagger UI.
